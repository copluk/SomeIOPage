<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>購買者管理 - 內部貿易系統</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .slide-in-left { animation: slideInLeft 0.4s ease-in-out; }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        /* <details> 標籤的箭頭樣式 */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details > summary::before {
            content: '\f0da'; /* Font Awesome right arrow */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 0.5rem;
            transition: transform 0.2s ease-in-out;
            display: inline-block;
        }
        details[open] > summary::before {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <div id="app" class="flex h-screen">
        
        <nav class="w-64 bg-white shadow-lg flex-shrink-0 flex flex-col">
            <div class="p-4 border-b flex items-center gap-3">
                <i class="fas fa-chart-line text-3xl text-indigo-600"></i>
                <h1 class="text-xl font-bold text-gray-800">內部貿易系統</h1>
            </div>
            <ul class="flex-grow">
                <li>
                    <a href="./suppliers.html" data-page="suppliers" class="flex items-center gap-3 p-4 text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors duration-200">
                        <i class="fas fa-truck w-5 text-center"></i>
                        <span>供應商管理</span>
                    </a>
                </li>
                <li>
                    <a href="./buyers.html" data-page="buyers" class="flex items-center gap-3 p-4 text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors duration-200">
                        <i class="fas fa-users w-5 text-center"></i>
                        <span>購買者管理</span>
                    </a>
                </li>
                <li>
                    <a href="./products.html" data-page="products" class="flex items-center gap-3 p-4 text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors duration-200">
                        <i class="fas fa-box-open w-5 text-center"></i>
                        <span>產品管理</span>
                    </a>
                </li>
                <li>
                    <a href="./attributes.html" data-page="attributes" class="flex items-center gap-3 p-4 text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors duration-200">
                        <i class="fas fa-tags w-5 text-center"></i>
                        <span>產品屬性管理</span>
                    </a>
                </li>
                <li>
                    <a href="./orders.html" data-page="orders" class="flex items-center gap-3 p-4 text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors duration-200">
                        <i class="fas fa-file-invoice-dollar w-5 text-center"></i>
                        <span>訂單管理</span>
                    </a>
                </li>
            </ul>
        </nav>

        <main class="flex-1 p-6 md:p-8 overflow-y-auto bg-gray-50">
            
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                     <h2 class="text-3xl font-bold text-gray-900">購買者管理</h2>
                     <button class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-200 shadow-sm">
                        <i class="fas fa-plus mr-2"></i>新增購買者
                     </button>
                </div>

                <div class="mb-4">
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-search text-gray-400"></i>
                        </span>
                        <input type="text" placeholder="依購買者名稱搜尋..." class="w-full md:w-1/3 p-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <div class="bg-white shadow-lg rounded-lg overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-4 text-left font-semibold text-gray-600 whitespace-nowrap">購買者公司名稱</th>
                                <th class="p-4 text-left font-semibold text-gray-600 whitespace-nowrap">主要聯絡人</th>
                                <th class="p-4 text-left font-semibold text-gray-600 whitespace-nowrap">聯絡人Email</th>
                                <th class="p-4 text-left font-semibold text-gray-600 whitespace-nowrap">聯絡人電話</th>
                                <th class="p-4 text-left font-semibold text-gray-600 whitespace-nowrap">負責業務</th>
                                <th class="p-4 text-left font-semibold text-gray-600 whitespace-nowrap">操作</th>
                            </tr>
                        </thead>
                        <tbody id="buyers-table-body" class="divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>

    <script>
    // --- 資料模型 (Data Model) - UPDATED ---
    const db = {
        Users: [
            { UserID: 1, Username: "sales_lin", FullName: "林業務", Email: "lin@example.com", AccountStatus: "Active", RoleID: 2 },
            { UserID: 2, Username: "manager_chen", FullName: "陳經理", Email: "chen@example.com", AccountStatus: "Active", RoleID: 1 }
        ],
        Roles: [ { RoleID: 1, RoleName: "管理者" }, { RoleID: 2, RoleName: "業務" } ],
        Suppliers: [
            { SupplierID: 1, SupplierName: "環球肉品公司", ContactPersonName: "王經理", ContactPersonEmail: "wang@worldmeat.com", ContactPersonPhone: "02-2788-1234", PaymentTerms: "月結30天", WebsiteURL: "https://www.worldmeat.com", Remarks: "每週一、四固定出貨。" },
            { SupplierID: 2, SupplierName: "頂級海鮮直送", ContactPersonName: "李小姐", ContactPersonEmail: "lee@topseafood.com", ContactPersonPhone: "07-555-8888", PaymentTerms: "貨到付款", WebsiteURL: "https://www.topseafood.com", Remarks: "需提前三天預訂特殊品項。" }
        ],
        Buyers: [
            { BuyerID: 101, BuyerName: "A級牛排館", AssignedSalespersonUserID: 1, ContactPersonName: "陳主廚", ContactPersonEmail: "chen.chef@asteak.com", ContactPersonPhone: "0912-345-678", PaymentTerms: "月結60天", WebsiteURL: null, Remarks: "偏好油花較少的部位。" },
            { BuyerID: 102, BuyerName: "饗食天堂餐飲集團", AssignedSalespersonUserID: 2, ContactPersonName: "採購部林先生", ContactPersonEmail: "procurement.lin@eat-together.com", ContactPersonPhone: "02-8780-8000", PaymentTerms: "月結45天", WebsiteURL: "https://www.eat-together.com", Remarks: "集團統一採購，需附檢驗報告。" }
        ],
        Product_Categories: [ { CategoryID: 1, PartName_ZH: "牛肉" }, { CategoryID: 2, PartName_ZH: "豬肉" }, { CategoryID: 3, PartName_ZH: "海鮮" } ],
        Products: [
            { ProductID: 1, SupplierID: 1, CategoryID: 1, ProductDisplayName: "澳洲和牛M9肋眼", ProductCode: "AW-RB-G9-001" }, { ProductID: 2, SupplierID: 1, CategoryID: 2, ProductDisplayName: "西班牙伊比利豬梅花", ProductCode: "SP-Pork-001" }, { ProductID: 3, SupplierID: 1, CategoryID: 2, ProductDisplayName: "台灣活菌豬五花", ProductCode: "TW-Pork-005" },
            { ProductID: 4, SupplierID: 2, CategoryID: 3, ProductDisplayName: "波士頓龍蝦", ProductCode: "SEA-LOB-01" }, { ProductID: 5, SupplierID: 2, CategoryID: 3, ProductDisplayName: "北海道干貝", ProductCode: "SEA-SCA-03" }, { ProductID: 6, SupplierID: 2, CategoryID: 3, ProductDisplayName: "智利鮭魚", ProductCode: "SEA-SAL-02" }
        ],
        Supplier_Quotes: [
            { SupplierQuoteID: 1, ProductID: 1, EffectiveTimestamp: "2025-05-20T00:00:00Z", SupplierOriginalPrice: 1800, InternalCostPrice: 1850 }, { SupplierQuoteID: 2, ProductID: 1, EffectiveTimestamp: "2025-06-01T00:00:00Z", SupplierOriginalPrice: 1820, InternalCostPrice: 1870 }, { SupplierQuoteID: 3, ProductID: 1, EffectiveTimestamp: "2025-06-10T00:00:00Z", SupplierOriginalPrice: 1810, InternalCostPrice: 1860 }, { SupplierQuoteID: 4, ProductID: 2, EffectiveTimestamp: "2025-06-01T00:00:00Z", SupplierOriginalPrice: 800, InternalCostPrice: 850 }, { SupplierQuoteID: 5, ProductID: 2, EffectiveTimestamp: "2025-06-05T00:00:00Z", SupplierOriginalPrice: 810, InternalCostPrice: 860 }, { SupplierQuoteID: 6, ProductID: 2, EffectiveTimestamp: "2025-06-08T00:00:00Z", SupplierOriginalPrice: 805, InternalCostPrice: 855 }, { SupplierQuoteID: 7, ProductID: 3, EffectiveTimestamp: "2025-06-02T00:00:00Z", SupplierOriginalPrice: 400, InternalCostPrice: 430 }, { SupplierQuoteID: 8, ProductID: 3, EffectiveTimestamp: "2025-06-06T00:00:00Z", SupplierOriginalPrice: 410, InternalCostPrice: 440 }, { SupplierQuoteID: 9, ProductID: 3, EffectiveTimestamp: "2025-06-09T00:00:00Z", SupplierOriginalPrice: 405, InternalCostPrice: 435 },
            { SupplierQuoteID: 10, ProductID: 4, EffectiveTimestamp: "2025-06-03T00:00:00Z", SupplierOriginalPrice: 1200, InternalCostPrice: 1250 }, { SupplierQuoteID: 11, ProductID: 4, EffectiveTimestamp: "2025-06-07T00:00:00Z", SupplierOriginalPrice: 1220, InternalCostPrice: 1270 }, { SupplierQuoteID: 12, ProductID: 4, EffectiveTimestamp: "2025-06-11T00:00:00Z", SupplierOriginalPrice: 1180, InternalCostPrice: 1230 }, { SupplierQuoteID: 13, ProductID: 5, EffectiveTimestamp: "2025-06-04T00:00:00Z", SupplierOriginalPrice: 900, InternalCostPrice: 940 }, { SupplierQuoteID: 14, ProductID: 5, EffectiveTimestamp: "2025-06-08T00:00:00Z", SupplierOriginalPrice: 910, InternalCostPrice: 950 }, { SupplierQuoteID: 15, ProductID: 5, EffectiveTimestamp: "2025-06-12T00:00:00Z", SupplierOriginalPrice: 890, InternalCostPrice: 930 }, { SupplierQuoteID: 16, ProductID: 6, EffectiveTimestamp: "2025-06-05T00:00:00Z", SupplierOriginalPrice: 700, InternalCostPrice: 740 }, { SupplierQuoteID: 17, ProductID: 6, EffectiveTimestamp: "2025-06-09T00:00:00Z", SupplierOriginalPrice: 710, InternalCostPrice: 750 }, { SupplierQuoteID: 18, ProductID: 6, EffectiveTimestamp: "2025-06-13T00:00:00Z", SupplierOriginalPrice: 690, InternalCostPrice: 730 }
        ],
        Quotes_To_Buyers: [
            { QuoteToBuyerID: 1, SupplierQuoteID: 3, ProductID: 1, BuyerID: 101, QuotedPrice: 2200, CustomerExpectedPrice: null, QuoteTimestamp: "2025-06-11T10:00:00Z", Status: "Negotiating", CreatedByUserID: 1 }, { QuoteToBuyerID: 2, SupplierQuoteID: 3, ProductID: 1, BuyerID: 101, QuotedPrice: null, CustomerExpectedPrice: 2150, QuoteTimestamp: "2025-06-11T11:00:00Z", Status: "Negotiating", CreatedByUserID: 1 }, { QuoteToBuyerID: 3, SupplierQuoteID: 3, ProductID: 1, BuyerID: 102, QuotedPrice: 2250, CustomerExpectedPrice: null, QuoteTimestamp: "2025-06-12T09:30:00Z", Status: "Negotiating", CreatedByUserID: 2 },
            { QuoteToBuyerID: 4, SupplierQuoteID: 6, ProductID: 2, BuyerID: 101, QuotedPrice: 1000, CustomerExpectedPrice: null, QuoteTimestamp: "2025-06-09T14:00:00Z", Status: "Accepted", CreatedByUserID: 1 }, { QuoteToBuyerID: 5, SupplierQuoteID: 9, ProductID: 3, BuyerID: 101, QuotedPrice: 550, CustomerExpectedPrice: null, QuoteTimestamp: "2025-06-10T11:00:00Z", Status: "Accepted", CreatedByUserID: 1 }, { QuoteToBuyerID: 6, SupplierQuoteID: 12, ProductID: 4, BuyerID: 101, QuotedPrice: 1400, CustomerExpectedPrice: null, QuoteTimestamp: "2025-06-12T15:00:00Z", Status: "Accepted", CreatedByUserID: 1 },
            { QuoteToBuyerID: 7, SupplierQuoteID: 15, ProductID: 5, BuyerID: 102, QuotedPrice: 1100, CustomerExpectedPrice: 1100, QuoteTimestamp: "2025-06-13T09:00:00Z", Status: "Ordered", CreatedByUserID: 2 }, { QuoteToBuyerID: 8, SupplierQuoteID: 18, ProductID: 6, BuyerID: 102, QuotedPrice: 850, CustomerExpectedPrice: 850, QuoteTimestamp: "2025-06-13T09:05:00Z", Status: "Ordered", CreatedByUserID: 2 }
        ],
        Orders: [
            { OrderID: 1, OrderNumber: "ORD-202506-001", BuyerID: 102, SupplierID: 2, LoadingTimestamp: "2025-07-15T00:00:00Z", ArrivalTimestamp: "2025-08-20T00:00:00Z", PaymentMethod: "T/T 30 days", OrderStatus: "Confirmed", CreatedByUserID: 2, SystemCreatedAt: "2025-06-13T10:00:00Z" }
        ],
        Order_Line_Items: [
            { LineItemID: 1, OrderID: 1, QuoteToBuyerID: 7, ProductID: 5, Weight: 500.5 }, { LineItemID: 2, OrderID: 1, QuoteToBuyerID: 8, ProductID: 6, Weight: 800.0 }
        ]
    };
    
    // --- 共用輔助函式 (Helper Functions) ---
    const formatDateTime = (iso) => iso ? new Date(iso).toLocaleString('zh-TW', { timeZone: "Asia/Taipei", year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false }).replace(/,/g, '') : 'N/A';
    const findById = (collectionName, id, keyName) => db[collectionName].find(item => item[keyName] === id);
    const getStatusBadge = (status) => {
        const styles = { Negotiating: 'bg-yellow-100 text-yellow-800', Accepted: 'bg-green-100 text-green-800', Rejected: 'bg-red-100 text-red-800', Ordered: 'bg-blue-100 text-blue-800', Confirmed: 'bg-sky-100 text-sky-800' };
        return `<span class="px-2 py-1 text-xs font-medium rounded-full whitespace-nowrap ${styles[status] || 'bg-gray-100 text-gray-800'}">${status}</span>`;
    };

    /**
     * 讓目前頁面的導航連結高亮
     */
    const highlightCurrentNav = () => {
        const currentPage = window.location.pathname.split('/').pop().replace('.html', '');
        if (currentPage) {
            const activeLink = document.querySelector(`a[data-page="${currentPage}"]`);
            if (activeLink) {
                activeLink.classList.add('bg-indigo-50', 'text-indigo-600', 'font-bold', 'border-l-4', 'border-indigo-600');
            }
        }
    };

    // --- buyers.html 頁面專屬的 JavaScript 邏輯 ---
    
    /**
     * 渲染購買者列表到表格中
     */
    function renderBuyerTable() {
        const tableBody = document.getElementById('buyers-table-body');
        if (!tableBody) return;

        // 文件規範的欄位：購買者公司名稱、主要聯絡人姓名、聯絡人Email、聯絡人電話、負責業務、備註
        // 由於假資料有完整欄位，我們可以直接填入
        tableBody.innerHTML = db.Buyers.map(buyer => {
            const salesperson = findById('Users', buyer.AssignedSalespersonUserID, 'UserID');
            
            return `
                <tr class="hover:bg-gray-50">
                    <td class="p-4 font-semibold">${buyer.BuyerName}</td>
                    <td class="p-4">${buyer.ContactPersonName}</td>
                    <td class="p-4">${buyer.ContactPersonEmail}</td>
                    <td class="p-4">${buyer.ContactPersonPhone}</td>
                    <td class="p-4">${salesperson?.FullName || 'N/A'}</td>
                    <td class="p-4 space-x-4">
                        <button class="text-gray-500 hover:text-gray-800 font-semibold text-sm">編輯</button>
                        <a href="./buyer-detail.html?id=${buyer.BuyerID}" class="text-indigo-600 hover:text-indigo-800 font-semibold text-sm">查看詳情</a>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // 當頁面載入完成後執行
    document.addEventListener('DOMContentLoaded', () => {
        highlightCurrentNav();
        renderBuyerTable();
    });
    
    </script>
</body>
</html>